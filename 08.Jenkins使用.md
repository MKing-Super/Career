# Jenkins使用

## 1 CentOS7

java17

jenkins 2.469

```bash
mkdir -p /usr/lib/jvm
tar -xzf OpenJDK17U-jdk_x64_linux_hotspot_17.0.15_6.tar.gz -C /usr/lib/jvm

# 设置环境变量
echo 'export JAVA_HOME=/usr/lib/jvm/jdk-17.0.15+6
export PATH=$JAVA_HOME/bin:$PATH' | sudo tee /etc/profile.d/java.sh

# 加载环境变量
source /etc/profile.d/java.sh

# 验证安装
java -version









# jenkins 安装
mkdir -p /usr/local/jenkins/{bin,logs,conf,data}
chown -R $USER:$USER /usr/local/jenkins

cat > /usr/local/jenkins/conf/jenkins.conf <<EOF
JENKINS_HOME=/usr/local/jenkins/data
JENKINS_PORT=8080
JENKINS_LOG=/usr/local/jenkins/logs/jenkins.log
JENKINS_ERROR_LOG=/usr/local/jenkins/logs/jenkins-error.log
EOF


cp jenkins.war /usr/local/jenkins/bin/


sudo cat > /etc/systemd/system/jenkins.service <<EOF
[Unit]
Description=Jenkins CI Server
After=network.target

[Service]
User=$USER
EnvironmentFile=/usr/local/jenkins/conf/jenkins.conf
WorkingDirectory=/usr/local/jenkins/data
ExecStart=$JAVA_HOME/bin/java -jar /usr/local/jenkins/bin/jenkins.war \
  --httpPort=\${JENKINS_PORT} \
  --logfile=\${JENKINS_LOG} \
  --webroot=/usr/local/jenkins/data/war
StandardOutput=append:\${JENKINS_LOG}
StandardError=append:\${JENKINS_ERROR_LOG}
Restart=always

[Install]
WantedBy=multi-user.target
EOF


systemctl daemon-reload
systemctl start jenkins
systemctl enable jenkins

systemctl status jenkins
tail -f /usr/local/jenkins/logs/jenkins.log

firewall-cmd --permanent --add-port=8080/tcp
firewall-cmd --reload
```

> systemctl stop jenkins

字体问题

```bash
# 安装基础字体包
sudo yum install -y fontconfig dejavu-sans-fonts dejavu-serif-fonts dejavu-sans-mono-fonts

# 重建字体缓存
fc-cache -fv

# 编辑 systemd 服务文件，添加字体相关环境变量：
sudo vi /etc/systemd/system/jenkins.service

# 在 [Service] 部分添加以下内容：
Environment="JAVA_TOOL_OPTIONS=-Djava.awt.headless=true -Djavax.accessibility.assistive_technologies="
Environment="FONTCONFIG_PATH=/etc/fonts"

# 重启 Jenkins 服务
sudo systemctl daemon-reload
sudo systemctl restart jenkins
tail -f /usr/local/jenkins/logs/jenkins.log  # 检查日志
```



## 2 Termux

```bash
# 安装字体和字体配置
pkg install fontconfig -y
pkg install fontconfig-utils -y
pkg install ttf-dejavu -y

# 重新生成字体配置
fc-cache -fv

# 检查Java字体配置
mkdir -p ~/.config/fontconfig/conf.d

# 创建或编辑字体配置文件：
vim ~/.config/fontconfig/fonts.conf

# 添加以下内容：
<?xml version="1.0"?>
<!DOCTYPE fontconfig SYSTEM "fonts.dtd">
<fontconfig>
    <dir>/data/data/com.termux/files/usr/share/fonts</dir>
    <cachedir>~/.cache/fontconfig</cachedir>
</fontconfig>


# 运行以下命令设置Java字体环境：
export JAVA_OPTS="-Dawt.useSystemAAFontSettings=on -Dswing.aatext=true -Djava.awt.headless=false"

# 如果要永久设置，可以添加到bashrc：
echo 'export JAVA_OPTS="-Dawt.useSystemAAFontSettings=on -Dswing.aatext=true -Djava.awt.headless=false"' >> ~/.bashrc
source ~/.bashrc

# 清理旧的Jenkins目录
rm -rf ~/.jenkins


# 下载Jenkins WAR包
wget https://get.jenkins.io/war-stable/latest/jenkins.war

# 启动Jenkins
java -jar jenkins.war --httpPort=9090
# 后台运行
nohup java -jar jenkins.war --httpPort=9090 > jenkins.log 2>&1 &

# 查看是否运行
ps -ef --forest | grep 'jenkins'
```

编写jenkins的启动脚本：

```shell
#!/bin/bash

# 模块名称
MODULE_NAME="jenkins"
# Jar包、日志存放 绝对路径
PROJECT_RUN_PATH="/data/data/com.termux/files/home/projects"
JAR_FILE_PATH="${PROJECT_RUN_PATH}/jars"
JAR_FILE_LOG_PATH="${PROJECT_RUN_PATH}/logs"
LOG_FILE="${JAR_FILE_LOG_PATH}/${MODULE_NAME}.log"

# Jenkins启动脚本
cd /data/data/com.termux/files/home/projects
nohup java -jar jenkins.war --httpPort=9090 > $LOG_FILE 2>&1 &
echo "Jenkins已启动，PID: $!"
```

