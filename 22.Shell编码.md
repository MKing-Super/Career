# Shell编码

## 1、基本

### 文件头部

```shell
#!/bin/bash
# 脚本名称: script_name.sh
# 作者: Your Name
# 创建时间: 2024-01-01
# 描述: 脚本功能描述
# 用法: ./script_name.sh [参数]

# 单行注释

```

### 变量命名

```shell
# 使用小写+下划线
user_name="admin"
max_retries=3
log_file="/var/log/app.log"

# 常量使用大写
readonly MAX_SIZE=1024
readonly DEFAULT_PORT=8080

# 正确 √
name="value"
echo "$name"

# 错误 X
name = "value"  # 等号两边不能有空格
```

### 引用变量

```shell
# 总是用双引号引用变量
echo "$filename"
cp "$source" "$destination"

# 除非需要分词
words="a b c"
for word in $words; do
    echo "$word"
done
```

### **函数编写**

```shell
# 函数定义
function log_info() {
    local message="$1"
    echo "[INFO] $(date): $message"
}

# 或
log_error() {
    local message="$1"
    echo "[ERROR] $(date): $message" >&2
}

# 使用函数
log_info "脚本开始执行"
```

### if语句

```shell
# 字符串比较
if [[ "$str" == "value" ]]; then
    echo "相等"
fi

if [[ -z "$str" ]]; then
    echo "为空"
fi

# 数字比较
if (( a > b )); then
    echo "a大于b"
fi

# 文件测试
if [[ -f "$file" ]]; then
    echo "文件存在"
fi

if [[ -d "$dir" ]]; then
    echo "目录存在"
fi
```

### for循环

```shell
# 遍历列表
for i in 1 2 3 4 5; do
    echo "数字: $i"
done

# C风格
for ((i=0; i<10; i++)); do
    echo "i=$i"
done

# 遍历文件
for file in *.txt; do
    echo "处理: $file"
done
```

### while循环

```shell
# 读取文件
while IFS= read -r line; do
    echo "行: $line"
done < file.txt

# 条件循环
count=0
while (( count < 5 )); do
    echo "计数: $count"
    ((count++))
done
```

### 脚本参数传递

```shell
#!/bin/bash
# 如果参数不存在，使用默认值，但不修改变量
username=${1:-"默认用户"}
port=${2:-8080}
host=${3:-"localhost"}

echo "用户名: $username"
echo "端口: $port"
echo "主机: $host"
```



## other

```shell
#!/bin/bash
a=${1:-1}
b=${2:-1}

echo "a = $a"
echo "b = $b"

if (( a > b )); then
    echo "a 大于 b"
elif (( a < b )); then
    echo "a 小于 b"
else
    echo "a 等于 b"
fi
```

执行命令选择：推荐bash

```
sh ./test
bash ./test
dash ./test
```

### 命令特性对比

| 特性          | sh (POSIX) | bash     | dash     |
| ------------- | ---------- | -------- | -------- |
| 数组          | ❌ 不支持   | ✅ 支持   | ❌ 不支持 |
| `[[ ]]`       | ❌ 不支持   | ✅ 支持   | ❌ 不支持 |
| `(( ))`       | ❌ 不支持   | ✅ 支持   | ❌ 不支持 |
| `${var:}`扩展 | 有限支持   | ✅ 全支持 | 有限支持 |
| 进程替换      | ❌ 不支持   | ✅ 支持   | ❌ 不支持 |
| 关联数组      | ❌ 不支持   | ✅ 支持   | ❌ 不支持 |





