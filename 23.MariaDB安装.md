# MariaDB

## 安装过程

```bash
# 安转
pkg install mariadb

mysql_install_db

# 启动 MariaDB
mysqld &

# 停止服务
pkill mysqld

# 连接数据库（首次无密码）
mysql -u root
```

数据库命令行sql：

```sql
-- 设置 root 密码（将 yourpassword 换成你的密码）
ALTER USER 'root'@'localhost' IDENTIFIED BY '你的密码';

-- 刷新权限
FLUSH PRIVILEGES;

-- 退出
EXIT;
```

重新进入：

```bash
# 有密码进入
mysql -u root -p
```

root可远程：

```sql
-- 查看现有 root 用户
SELECT user, host FROM mysql.user WHERE user = 'root';

-- 创建或修改 root 用户允许远程连接
-- 方法1：如果 root@localhost 已存在
CREATE USER 'root'@'%' IDENTIFIED BY '123456';
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' WITH GRANT OPTION;

-- 方法2：修改已有 root 的 host
UPDATE mysql.user SET host='%' WHERE user='root' AND host='localhost';

-- 刷新权限
FLUSH PRIVILEGES;

-- 再次查看
SELECT user, host FROM mysql.user WHERE user = 'root';
```

创建其他用户，指定权限：

```sql
-- 创建远程用户（将 username 和 password 替换）
CREATE USER 'remote_user'@'%' IDENTIFIED BY '123456';

-- 授予所有权限（生产环境建议限制权限）
GRANT ALL PRIVILEGES ON *.* TO 'remote_user'@'%' WITH GRANT OPTION;

-- 或者授予特定数据库权限
GRANT ALL PRIVILEGES ON 数据库名.* TO 'remote_user'@'%';

-- 刷新权限
FLUSH PRIVILEGES;

-- 查看用户权限
SELECT user, host FROM mysql.user;
```

## **实用命令**

```bash
# $PREFIX 为 /data/data/com.termux/files/usr
# 查看数据库占用的磁盘空间
du -sh $PREFIX/var/lib/mysql/

# 查看最大的数据库
du -sh $PREFIX/var/lib/mysql/* | sort -hr

# 查看日志大小
ls -lh $PREFIX/var/log/mysql*.log 2>/dev/null

# 备份整个数据目录
cp -r $PREFIX/var/lib/mysql/ ~/mysql_backup/

# 查看当前使用的配置文件
mysqld --help --verbose 2>/dev/null | grep -A1 "Default options"
```



## 其他

MariaDB的文件位置：

```
# 基本路径前缀
/data/data/com.termux/files/usr/

# 完整路径
/data/data/com.termux/files/usr/var/lib/mysql/        # 数据文件
/data/data/com.termux/files/usr/var/log/mysqld.log    # 日志文件
/data/data/com.termux/files/usr/var/run/mysqld.sock   # Socket文件
/data/data/com.termux/files/usr/etc/my.cnf            # 配置文件
```

sql

```
-- 查看关键路径
SHOW VARIABLES LIKE 'datadir';
SHOW VARIABLES LIKE 'basedir';
SHOW VARIABLES LIKE 'tmpdir';
SHOW VARIABLES LIKE 'log_error';
SHOW VARIABLES LIKE 'socket';
SHOW VARIABLES LIKE 'pid_file';
```

结构图

```
Termux MariaDB 目录结构
├── $PREFIX/                    # /data/data/com.termux/files/usr/
│   ├── etc/
│   │   ├── my.cnf             # 主配置文件
│   │   └── my.cnf.d/          # 配置片段
│   ├── var/
│   │   ├── lib/
│   │   │   └── mysql/         # 数据目录（核心）
│   │   │       ├── mysql/     # 系统数据库
│   │   │       ├── ibdata1    # 系统表空间
│   │   │       ├── ib_logfile0
│   │   │       ├── ib_logfile1
│   │   │       └── database/  # 用户数据库目录
│   │   ├── log/
│   │   │   ├── mysqld.log     # 错误日志
│   │   │   └── mysql.log      # 查询日志
│   │   └── run/
│   │       └── mysqld/
│   │           ├── mysqld.sock # Socket文件
│   │           └── mysqld.pid  # PID文件
│   └── tmp/                   # 临时文件目录
├── ~/.my.cnf                  # 用户配置文件
└── 数据库文件示例：
    ├── mydatabase/            # 数据库目录
    │   ├── mytable.frm       # 表结构
    │   ├── mytable.MYD       # 表数据
    │   └── mytable.MYI       # 表索引
    └── mysql/                # 系统数据库
        ├── user.frm
        ├── user.MYD
        └── user.MYI
```

