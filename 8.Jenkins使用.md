# Jenkins使用

已安装java17

```bash
mkdir -p /usr/lib/jvm
tar -xzf OpenJDK17U-jdk_x64_linux_hotspot_17.0.15_6.tar.gz -C /usr/lib/jvm

# 设置环境变量
echo 'export JAVA_HOME=/usr/lib/jvm/jdk-17.0.15+6
export PATH=$JAVA_HOME/bin:$PATH' | sudo tee /etc/profile.d/java.sh

# 加载环境变量
source /etc/profile.d/java.sh

# 验证安装
java -version



mkdir -p /usr/local/jenkins/{bin,logs,conf,data}
chown -R $USER:$USER /usr/local/jenkins

cat > /usr/local/jenkins/conf/jenkins.conf <<EOF
JENKINS_HOME=/usr/local/jenkins/data
JENKINS_PORT=8080
JENKINS_LOG=/usr/local/jenkins/logs/jenkins.log
JENKINS_ERROR_LOG=/usr/local/jenkins/logs/jenkins-error.log
EOF


cp jenkins.war /usr/local/jenkins/bin/


sudo cat > /etc/systemd/system/jenkins.service <<EOF
[Unit]
Description=Jenkins CI Server
After=network.target

[Service]
User=$USER
EnvironmentFile=/usr/local/jenkins/conf/jenkins.conf
WorkingDirectory=/usr/local/jenkins/data
ExecStart=$JAVA_HOME/bin/java -jar /usr/local/jenkins/bin/jenkins.war \
  --httpPort=\${JENKINS_PORT} \
  --logfile=\${JENKINS_LOG} \
  --webroot=/usr/local/jenkins/data/war
StandardOutput=append:\${JENKINS_LOG}
StandardError=append:\${JENKINS_ERROR_LOG}
Restart=always

[Install]
WantedBy=multi-user.target
EOF


sudo systemctl daemon-reload
sudo systemctl start jenkins
sudo systemctl enable jenkins

sudo systemctl status jenkins
tail -f /usr/local/jenkins/logs/jenkins.log

sudo firewall-cmd --permanent --add-port=8080/tcp
sudo firewall-cmd --reload
```

字体问题

```bash
# 安装基础字体包
sudo yum install -y fontconfig dejavu-sans-fonts dejavu-serif-fonts dejavu-sans-mono-fonts

# 重建字体缓存
fc-cache -fv

# 编辑 systemd 服务文件，添加字体相关环境变量：
sudo vi /etc/systemd/system/jenkins.service

# 在 [Service] 部分添加以下内容：
Environment="JAVA_TOOL_OPTIONS=-Djava.awt.headless=true -Djavax.accessibility.assistive_technologies="
Environment="FONTCONFIG_PATH=/etc/fonts"

# 重启 Jenkins 服务
sudo systemctl daemon-reload
sudo systemctl restart jenkins
tail -f /usr/local/jenkins/logs/jenkins.log  # 检查日志
```

